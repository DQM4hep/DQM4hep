/// \file QualityTest.h
/*
 *
 * QualityTest.h header template automatically generated by a class generator
 * Creation date : ven. fï¿½vr. 20 2015
 *
 * This file is part of DQM4HEP libraries.
 *
 * DQM4HEP is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * based upon these libraries are permitted. Any copy of these libraries
 * must include this copyright notice.
 *
 * DQM4HEP is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with DQM4HEP.  If not, see <http://www.gnu.org/licenses/>.
 *
 * @author Remi Ete, DESY
 */


#ifndef DQM4HEP_QUALITYTEST_H
#define DQM4HEP_QUALITYTEST_H

// -- dqm4hep headers
#include "dqm4hep/DQM4HEP.h"

// -- json headers
#include <json/json.h>

// -- root headers
#include "TObject.h"

namespace dqm4hep {

  namespace core {

    class TiXmlHandle;

    /** QualityTestReport class
     *  Hanlde the result of a quality test
     */
    class QualityTestReport
    {
    public:
      /** Constructor
       */
      QualityTestReport();

      /** Copy constructor
       */
      QualityTestReport(const QualityTestReport &qreport);

      /** Assignment operator
       */
      QualityTestReport &operator=(const QualityTestReport &qreport);

      /**
       * [toJson description]
       * @param value [description]
       */
      void toJson(Json::Value &value) const;

      /**
       * [fromJson description]
       * @param value [description]
       */
      void fromJson(const Json::Value &value);

    public:
      std::string           m_qualityTestName;
      std::string           m_qualityTestType;
      std::string           m_qualityTestDescription;
      std::string           m_monitorElementName;
      std::string           m_monitorElementType;
      std::string           m_message;
      float                 m_quality;
      bool                  m_isSuccessful;
      Json::Value           m_extraInfos;
    };

    typedef QualityTestReport QReport;

    //-------------------------------------------------------------------------------------------------
    //-------------------------------------------------------------------------------------------------

    /** QualityTest class
     */
    class QualityTest
    {
    public:
      /** Constructor
       */
      QualityTest(const std::string &type, const std::string &name);

      /** Destructor
       */
      virtual ~QualityTest();

      /** Get the quality test type
       */
      const std::string &type() const;

      /** Get the quality test name (unique identifier)
       */
      const std::string &name() const;

      /** Perform the quality test result and fill the quality test report
       */
      void run(MonitorElement *pMonitorElement, QualityTestReport &report);

      /** Read the settings from the xml handle
       */
      virtual StatusCode readSettings(const dqm4hep::core::TiXmlHandle xmlHandle) = 0;

      /** Initialize the quality test.
       */
      virtual StatusCode init();

    protected:
      /** Runs a quality test on the given monitor element
       */
      virtual StatusCode userRun(MonitorElement *pMonitorElement, QualityTestReport &report) = 0;

      /** Whether the quality test can be run on the monitor element
       */
      virtual bool canRun(MonitorElement *pMonitorElement) const = 0;

      /** Fill basic info in the qtest report.
       *  Must be called at start of qtest run
       */
      void fillBasicInfo(MonitorElement *pMonitorElement, QualityTestReport &report) const;
      
    private:
      std::string           m_type;           ///< Quality test type (usually class name)
      std::string           m_name;           ///< Quality test name
      
    protected:
      std::string           m_description;    ///< Quality test description
    };

    //-------------------------------------------------------------------------------------------------
    //-------------------------------------------------------------------------------------------------

    /** QualityTestFactory class
     */
    class QualityTestFactory
    {
    public:
      /** Destructor
       */
      virtual ~QualityTestFactory();

      /** Create a quality test
       */
      virtual QualityTest *createQualityTest(const std::string &name) const = 0;
    };

    //-------------------------------------------------------------------------------------------------
    //-------------------------------------------------------------------------------------------------
    
    inline StatusCode QualityTest::init()
    {
      return STATUS_CODE_SUCCESS;
    }

    //-------------------------------------------------------------------------------------------------

    inline QualityTestFactory::~QualityTestFactory()
    {
      /* nop */
    }

  }

}

#endif  //  DQM4HEP_QUALITYTEST_H
